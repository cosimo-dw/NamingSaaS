<body id="orders" xmlns="http://www.w3.org/1999/html">
<div id="columns">
  <div id="side">
    <h3><%= @order.product.name%>, <%= @order.user.name %>, <%= @order.price %> </h3>
    <% if @order.product_attribute_values.any? %>
        <div id="product_attributes">
          <ul>
            <% @order.product_attribute_values.each do |v| %>
              <li><%= v.product_attribute.name %>： <%= v.value %></li>
            <% end %>
          </ul>
        </div>
    <% end %>

    <% if @order.num_answers == 1 %>
        <h3> 反馈信息 </h3>
        <% if @order_type == 'Personal' or @order_type == 'Company' %>
            <div>
              算命师所取的名字
            </div>
            <div>
              <%= @answers.chosen_name %>
            </div>
            <div>
              算命师的详细解释
            </div>
            <div>
              <%= @answers.content %>
            </div>
        <% else %>
            <div>
              算命师为您的八字所作的分析
            </div>
            <div>
              <%= @answers.content %>
            </div>
        <% end %>
    <% end %>
  </div>

  <!-- 这一部分是管理员给取的名字以及解释 -->
  <% if @i_am_admin == true %>
      <div id="reply">


        <% if @order_type == 'Personal' or @order_type == 'Company' %>
        <h3>为客户取名</h3>

          <% if not @answers %>
            <div class="depot-form">
            <%= form_for @answer do |f| %>
                <%= render :partial => 'reply_create_or_update', :locals => {f: f}%>
            <% end %>
            </div>

          <% else %>
            <div class="depot-form">
              <%= form_for(@answers, url: answer_path(@answers), html:{method: :put}) do |f| %>
                  <%= render :partial => 'reply_create_or_update', :locals => {f: f}%>
              <% end %>
            </div>

          <% end %>


        <% else %>
        <h3>为客户算命</h3>

        <% if not @answers %>   <!-- 第一次反馈！ -->
        <div class="depot-form">
          <%= form_for @answer do |f| %>
            <%= render :partial => 'reply_create_or_update', :locals => {f: f}%>
          <% end %>
        </div>

        <% else %>
        <div class="depot-form">
          <%= form_for(@answers, url: answer_path(@answers), html:{method: :put}) do |f| %>
            <%= render :partial => 'reply_create_or_update', :locals => {f: f}%>
          <% end %>
        </div>

        <% end %>
        <% end %>
      </div>


      <!-- for test!! -->
      <!-- render :partial => 'reply_create_or_update' -->
  <% end %>


  <div id="main">
    <h3>新留言</h3>
      <div class="depot-form">
      <%= form_for @message do |f| %>
          <div>
          <%= f.text_area :content, :id => 'message_content'%>
          </div>
          <%= f.hidden_field :order_id, :value => @order.id%>
          <%=submit_tag "留言", :class=> "btn  btn-primary"%>
          <!-- f.submit "留言", class: "btn btn-large btn-primary" -->
      <% end %>
      </div>
  </div>

  <div class="row">
    <div class="span12">
      <% if @order.messages.any? %>
          <h3>所有留言(<%= @order.messages.count %>)</h3>
          <ol class="messages">
            <%= render @messages %>
          </ol>
          <%= will_paginate @messages %>
      <% end %>
    </div>
  </div>
</div>
</div>
</body>





